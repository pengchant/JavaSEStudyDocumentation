# 1. 数据库介绍和MySQL安装

## 1.1 数据库的概念和一些说明

　　顾名思义，数据库就是“存储数据的仓库”。数据的存储非常重要，可以说，数据就是企业的灵魂，如银行储户信息的存储、员工资料的存储、电商网站商品信息和订单信息的存储等等。我们以后学习的Java EE也是跟数据库打交道。

　　在数据库软件出现之前，程序中单纯用文件来存储需要永久保留的信息，但是当数据量大、并发性高等情况出现时，单纯用文件来存储信息会遇到很多问题。这才导致数据库的产生。数据库专门用于有效的管理数据，关于更多的内容，大家应该阅读书籍《数据库系统概念（本科教学版）》的前几章。

　　现在主流的大部分数据库都是关系型数据库，即数据存放在二维表中，然后表与表之间有一定的关系。通过数据库存储数据，我们就能使用SQL语言来准确迅速的操作数据表的数据和查询数据表的数据。因此我们也要学习SQL语句。

　　SQL语句是根据标准使用的，但是不同的数据库软件还是有微小的区别。常见的关系型数据库有：Oracle、SQL Server和MySQL。Oracle数据库是甲骨文公司开发的大型数据库，适合大型应用；SQL Server是微软开发的数据库软件，与Windows平台结合较好；MySQL的社区（Community）版是免费开源的产品，适合中小企业使用。

　　我们以MySQL数据库产品为例，推荐先学习《MySQL数据库应用：从入门到精通》这个入门书。本教程重点在于介绍用Java连接数据库来获取数据库中的数据，因此下面针对MySQL，讲解MySQL的安装，并且讲解在MySQL中使用常用的SQL语句和一些技术点，相当于是总结使用。还是推荐大家先学习《数据库系统概念》（只看前面几章即可，毕竟后面的太难，实际中也用不到）和《MySQL数据库应用：从入门到精通》，如果有数据库知识，可直接往下看。不排除以后单独推出数据库的教程，到时再做修改。

## 1.2 MySQL的安装

　　推荐在镜像网站上下载MySQL的Windows 64位MSI安装版本。地址：http://mirrors.sohu.com/mysql 。我们选择MySQL-5.7目录中的文件“mysql-5.7.17-winx64.msi”下载安装。这是目前的最新版本。

　　点击msi文件进行安装，注意选择合适的安装位置（我选择的位置是D:\DevTools\MySQL）。这里的安装过程只相当于解压文件了，具体的安装还需要我们手动执行。步骤如下：

　　（1）进入安装目录，在这里我就进入D:\DevTools\MySQL目录。将MySQL资源中提供的my.ini配置文件复制到此目录，并且在此目录新建一个文件夹名为“Uploads”。注意，如果你选择的安装目录在其他位置，则应修改my.ini文件中凡是出现“D:/DevTools/MySQL”的地方，换成自己的安装目录。

　　（2）进入MySQL安装目录的bin目录，并在此目录用“管理员”身份打开控制台。

　　（3）在控制台执行如下命令：mysqld --initialize --user=mysql --console。执行成功会出现以下信息：

```
2017-02-06T04:10:53.255285Z 0 [Warning] 'NO_ZERO_DATE', 'NO_ZERO_IN_DATE' and 'ERROR_FOR_DIVISION_BY_ZERO' sql modes should be used with strict mode. They will be merged with strict mode in a future release.
2017-02-06T04:10:55.472257Z 0 [Warning] InnoDB: New log files created, LSN=45790
2017-02-06T04:10:55.972246Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.
2017-02-06T04:10:56.175407Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: 41fff59c-ec22-11e6-a377-201a068ed52e.
2017-02-06T04:10:56.206670Z 0 [Warning] Gtid table is not ready to be used. Table 'mysql.gtid_executed' cannot be opened.
2017-02-06T04:10:56.222258Z 1 [Note] A temporary password is generated for root@localhost: hG#emkEaK1*:
```

　　注意最后一行，“A temporaty password is generated for root@localhost:...”，意思是为root用户用于生成了一个临时的密码，冒号后面就是生成的密码，要记住他，下面需要用到。而root就是MySQL数据库中的“超级管理员账户”，拥有最高的权限，需要谨慎对待。

　　（4）继续执行命令：mysqld --install MySQL，即安装MySQL服务。

　　（5）执行命令：net start MySQL：用于启动MySQL服务，只有启动了MySQL服务，才能成功连接MySQL服务器进行操作。

　　（6）使用root用户名和密码登录数据库。执行：mysql –u root -p，随后根据提示输入刚才生成的密码，即可登录系统。输出如下：

```
D:\DevTools\MySQL\bin>mysql -u root -p
Enter password: ************
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 3
Server version: 5.7.17-log MySQL Community Server (GPL)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
```

　　光标会等待在mysql>的后面，等待输入指令以便操作数据库。如果想退出MySQL的“命令行”，直接输入exit回车即可。至此，MySQL已经安装成功。下一步需要修改临时的root密码。这时是在MySQL“命令行”中执行命令。

　　（7）修改root密码需要执行下面一系列操作：

　　执行命令：use mysql; 表示将要操作mysql这个数据库。

　　执行命令：update user set authentication_string=password('你的密码') where user='root' and host='localhost'; 此条命令将会使root密码设置为自己定义的密码。这是SQL命令，必须在最后输入分号或者\g才能执行，因为MySQL默认把分号或者\g当做一条SQL语句的结束，并开始执行。

　　执行命令：flush privileges; 用来刷新权限以使设置生效。

　　执行命令：alter user 'root'@'localhost' identified by '你的密码'; 

　　再执行：flush privileges; 刷新权限。

　　此时，修改密码已设置完毕，可退出MySQL，重新使用mysql –u root -p连接数据库，此时就需要使用刚才设置的新密码了。

## 1.3 允许外界远程连接本机MySQL

　　下面设置root用户可远程登录本机MySQL，并具有所有的权限。因为在有些时候，当本机作为服务器时，用其他客户机远程连接本机的MySQL进行操作，这将会非常方便。

　　操作的步骤如下：

　　（1）在MySQL中执行下面两条语句

　　grant all privileges on *.* to 'root'@'%' identified by '你的密码' with grant option;和

　　flush privileges; 刷新权限。

　　（2）在Windows上，还需要设置防火墙，否则Windows的防火墙默认阻止外界访问MySQL监听的3306端口。设置方法如下：

　　打开“高级安全Windows防火墙”程序。打开方式如下：控制台执行“firewall.cpl”命令，将打开“Windows防火墙”，然后点击右侧的“高级设置”即可打开。

![](images/16/1-1.png)

　　需要在“高级安全Windows防火墙”中新建入站规则，即在“入站规则”中“新建规则”（因为目的是允许外界通过3306端口访问本机的MySQL，因此是“入站”）：

![](images/16/1-2.png)

　　在弹出的窗口中选择“端口”，然后进行下一步：

![](images/16/1-3.png)

　　在此步中默认选择TCP（因为数据库连接必须选择可靠的协议，而不能用UDP。这点可以用下面的命令验证：netstat -ano|findstr "3306"。此命令用于查看和端口3306相关的连接），在“特定端口中”指定3306这个端口，即：

![](images/16/1-4.png)

　　然后在下面的配置中用默认的选项即可完成配置（默认选项即允许外部访问此端口）。最后一步是给这个规则起个名字和它的描述信息，这个自己写就好了。这样，我们就能在“入站规则”中看到我们建立的规则，此时外界连接本机的MySQL就可正常连接。

## 1.4 关于MySQL服务和卸载MySQL

　　默认MySQL服务会在开机时自启，所以我们可直接连上MySQL服务器。为了避免占用系统内存，建议在不使用MySQL时关闭MySQL服务。关闭的方式是执行命令：net stop MySQL。和启动MySQL服务命令类似。当然，若需要连接MySQL服务器，别忘了执行net start MySQL开启服务，否则无法连接服务器。

　　我们也可在Windows提供的“服务”程序中对系统中的各项服务进行管理，包括MySQL服务。可以在“服务”中开启和停止MySQL服务，也可以设置MySQL服务的启动类型为“手动”，这样MySQL不会在开机时自启，而是需要手动开启。

　　若想卸载MySQL服务器时，需要按照下述步骤进行：

　　（1）关闭MySQL服务；

　　（2）用管理员身份执行命令：sc delete MySQL，此命令用于删除MySQL服务；

　　（3）删除MySQL的整个安装目录。

# 2. 以MySQL为例总结数据库使用要点

　　前提还是希望大家有数据库概念的知识。

## 2.1 使用MySQL

　　在第一章学习中，已经安装好了MySQL。这样每次使用MySQL时，只需开启MySQL服务，然后使用root账号和密码登录MySQL进行操作即可。即使用mysql –u root –p命令在命令行中登录并进行操作。为了方便使用mysql命令，我们可以将MySQL安装目录下的bin目录添加到Path环境变量中。

　　但是在命令行中写命令操作数据库确实不方便，也不直观，我们可以使用友好的可视化软件连接数据库，然后在此工具中执行命令并看到结果。推荐的工具是SQLyog和官方提供的工具MySQL Workbench。我们以SQLyog为例。当然别忘了，在没有GUI软件可用时，命令行总是可用的工具。

　　安装好SQLyog后，出现以下界面：

![](images/16/2-1.png)

　　默认地址是localhost，就是本机，也可以改为127.0.0.1,。默认用户名就是root，然后需要自己输入root的密码。端口就是默认的3306，Databases一项不需要填写。

　　写好密码后，可点击Connect按钮连接上数据库。如果弹出错误信息，则表示连接失败，应检查MySQL服务是否开启，并且检查密码是否正确。如果想新建一个连接信息，则点击左上角的“New...”按钮。

　　连上数据库后，软件界面如下：

![](images/16/2-2.png)

　　以上介绍中的功能是最常用的也最方便。

## 2.2 数据库管理

　　可以在MySQL中创建多个数据库，一个数据库一般就用来存储一个系统所需要的所有数据。一个数据库中可创建多张表，每张表中可存储具体的数据。操作数据库的语言就是SQL。

　　现在讲基本的数据库的管理。

　　（1）查询MySQL中所有的数据库：show databases; 

　　该命令会显示MySQL中所有的数据库。即使我们现在没有创建一个数据库，还是会看到几个数据库，这几个数据库是MySQL自带的数据库，存储了MySQL的必要信息。

　　（2）创建数据库。使用“create database 数据库名”来创建一个数据库。比如create database test来创建一个名为test的数据库。

　　在创建数据库时，可以指定此数据库的默认字符集，现在一般使用通用的utf-8字符集，比如：create database test default set character utf-8; 但是我们也不用指定，因为我们安装MySQL时，配置文件就设置了MySQL默认使用utf-8编码。

　　在使用SQLyog时，在左侧右键“Create Database...”即可创建数据库，会让你选择编码和有关排序的选项，选择有关UTF-8的即可，即：

![](images/16/2-3.png)

　　（3）修改数据库编码，使用alter database...，比如将上述的test数据库编码改成gbk的：alter database test default character set gbk; 一般不需改变，统一用utf-8编码较方便和通用。

　　（4）删除数据库：使用“drop database 数据库名”，比如drop database test。注意谨慎使用，因为数据不可恢复。

## 2.3 数据表管理

　　在一个数据库中有多个表，表中存放数据，因此最常用的就是操作表数据的SQL语句。

　　首先，应该选定MySQL中的一个数据库，使用use命令切换选中的数据库，比如use test; 命令说明下面操作的都是test数据库中的表。

### 2.3.1 基本的表管理

　　（1）创建表。例子，新建一个学生表，可存储编号、姓名和年龄信息：

```sql
CREATE TABLE student (-- student是表名
  -- 括号中定义表的列名和对应的数据类型
  sid   INT, -- 编号一列是整型
  sname VARCHAR(20), -- 姓名是字符串
  sage  INT              -- 年龄是整型
)
```

　　SQL语句是不区分大小写的，MySQL中默认也不区分列名等大小写。MySQL使用“-- ”作为单行注释的开始。注意两个横线后至少要有一个空格。

　　（2）显示该数据库中所有表：show tables。即可显示刚刚我们创建的student表。

　　（3）查看表的结构，使用“desc 表名”，如desc student就能看到我们创建的表的结构。

　　（4）修改(alter)表：

-    添加一列：add column

　　alter table student add column sgender varchar(2); -- 给表加上sgender列，类型是字符串。

-    删除一列：drop column

　　alter table student drop column sgender; -- 删除sgender列。

-    修改列数据类型：modify column

　　alter table student modify column sage varchar(3); -- 将年龄列类型变为字符串。

-    修改列名称：change column，也需要写修改后列的类型

　　alter table student change column sage sgender varchar(3); -- 将年龄列改为性别列。

-    修改表名称：rename to

　　alter table student rename to teacher; -- 修改表名称为teacher。

　　（5）删除表：使用drop。比如drop table teacher就是删除teacher表。

### 2.3.2 表数据的增删改

　　数据管理就是数据的增删改查，即CRUD【Create、Read、Update和Delete】。这里先讲表数据的增删改。数据的查询需要详细的学习。

　　（1）插入：insert into...values

```sql
-- 在student中插入一条完整数据。括号中值要按序填写
insert into student values(1, '张三', 20);
-- 可只插入部分数据，要在表名后指明列名。values括号中也要按照表名括号中顺序插入
insert into student(sid, sname) values(1, '张三');
```

　　可以看出，MySQL中字符串要包含在单引号中。在insert into...语句中，into关键字是可以省略的。

　　（2）更新（修改）：update...set

```sql
-- 将表中所有人的年龄设置为25
update student set sage = 25;
-- 加上where子句指定条件。这里只修改名字为'张三'的人年龄为30
update student set sage = 30 where sname = '张三';
-- 也可同时修改多个列。
update student set sname = '李四', sage = 40 where sid = 1;
```

　　（3）删除：delete...from

```sql
-- 删除表中所有数据
delete from student;
-- 带where条件的删除
delete from student where sname = '张三';
```

　　以上所有语句的执行，都可用select * from student查看表中的数据变化。

### 2.3.3 MySQL中的注释

　　（1）行注释：从字符#开始到行尾；或者从“-- ”开始到行尾，此方式要求两个横线后至少有一个空格。

　　（2）多行注释：/*   */。

### 2.3.4 数据表的查询

